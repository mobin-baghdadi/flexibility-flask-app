<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ø§ÙˆÛŒÙ‡ Ø§Ù†Ø¹Ø·Ø§Ùâ€ŒÙ¾Ø°ÛŒØ±ÛŒ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:'Tahoma','Arial',sans-serif;padding:20px;background:repeating-linear-gradient(45deg,#000 0 10px,#1a0000 10px 20px),linear-gradient(135deg,#000,#8b0000);background-blend-mode:overlay;color:#f0f0f0;direction:rtl;}
#image-container{position:relative;display:inline-block;margin-top:20px;max-width:100%;}
#uploaded-image,#guide-image{max-width:100%;height:auto;border-radius:10px;border:2px solid #ccc;display:block;}
.point{position:absolute;width:16px;height:16px;background:#e74c3c;border-radius:50%;border:2px solid white;transform:translate(-50%,-50%);pointer-events:none;box-shadow:0 0 5px rgba(0,0,0,0.3);z-index:11;}
button{background-color:#27ae60;color:white;border:none;padding:10px 15px;border-radius:6px;cursor:pointer;margin-right:8px;margin-top:10px;min-width:130px;}
button:disabled{background-color:#95a5a6;cursor:not-allowed;}
#result{margin-top:25px;padding:15px;border-radius:10px;background-color:#fff;color:#2c3e50;text-align:center;font-size:1.1em;}
.footer{margin-top:50px;border-top:1px solid #ccc;padding-top:15px;text-align:center;font-size:0.9em;color:#ffee00;}
.footer img{vertical-align:middle;margin-left:5px;width:18px;height:18px;}
.footer a{color:#3498db;text-decoration:none;}
</style>
</head>
<body>

<div id="welcome-msg">ğŸ‘‹ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯! Ø§Ø¨ØªØ¯Ø§ ØªØµÙˆÛŒØ± Ø±Ø§Ù‡Ù†Ù…Ø§ Ø±Ø§ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ù†ÛŒØ¯.</div>
<img id="guide-image" src="{{ url_for('static', filename='guide.jpg') }}" alt="Ø±Ø§Ù‡Ù†Ù…Ø§" />

<input type="file" id="image-input" accept="image/*" style="margin-top:15px;">
<div id="image-container" style="display:none;">
  <img id="uploaded-image" src="#">
</div>
<button id="calc-btn" disabled>Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ø§ÙˆÛŒÙ‡ Ø§Ù†Ø¹Ø·Ø§Ùâ€ŒÙ¾Ø°ÛŒØ±ÛŒ</button>
<button id="clear-btn">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù†Ù‚Ø§Ø·</button>

<div id="result"></div>

<div class="footer">
  <p><strong>ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø§:</strong></p>
  <p>
    <img src="https://img.icons8.com/ios-filled/20/000000/instagram-new.png"/> 
    Ø¹Ù„ÛŒØ±Ø¶Ø§ Ø±Ø³ØªÙ…ÛŒ: <a href="https://instagram.com/Rostami_insta" target="_blank">@Rostami_insta</a><br>
    <img src="https://img.icons8.com/ios-filled/20/000000/instagram-new.png"/> 
    Ù…Ø­Ù…Ø¯Ù…Ø¨ÛŒÙ† Ø¨ØºØ¯Ø§Ø¯ÛŒ: <a href="https://instagram.com/mobin__baghdadi" target="_blank">@mobin__baghdadi</a>
  </p>
</div>

<script>
let uploadedImage = document.getElementById('uploaded-image');
let guideImage = document.getElementById('guide-image');
let imageContainer = document.getElementById('image-container');
let imageInput = document.getElementById('image-input');
let calcBtn = document.getElementById('calc-btn');
let clearBtn = document.getElementById('clear-btn');
let resultDiv = document.getElementById('result');

let labels = ['Ù„Ú¯Ù†','Ù…Ú† Ù¾Ø§ÛŒ Ú†Ù¾','Ù…Ú† Ù¾Ø§ÛŒ Ø±Ø§Ø³Øª'];
let points = [], step = 0;
let imageBase64 = "";

// Ù†Ù…Ø§ÛŒØ´ Ø¹Ú©Ø³ Ø±Ø§Ù‡Ù†Ù…Ø§ Û¶ Ø«Ø§Ù†ÛŒÙ‡
setTimeout(()=>{ 
    document.getElementById('welcome-msg').textContent='ØªØµÙˆÛŒØ± Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯ Ùˆ Ø±ÙˆÛŒ Û³ Ù†Ù‚Ø·Ù‡ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.'; 
},6000);

// Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØµÙˆÛŒØ± Ú©Ø§Ø±Ø¨Ø±
imageInput.addEventListener('change', e=>{
    const file = e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = ()=>{
        uploadedImage.src = reader.result;
        imageBase64 = reader.result;
        step=0; points=[];
        imageContainer.style.display='inline-block';
        calcBtn.disabled=true;
        document.querySelectorAll('.point').forEach(p=>p.remove());
    };
    reader.readAsDataURL(file);
});

// Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ ØªØµÙˆÛŒØ± Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ù‚Ø§Ø·
uploadedImage.addEventListener('click', e=>{
    if(step>=labels.length) return;
    const rect = uploadedImage.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    const pointDiv = document.createElement('div');
    pointDiv.className='point';
    pointDiv.style.left=x+'px';
    pointDiv.style.top=y+'px';
    pointDiv.title=labels[step];
    imageContainer.appendChild(pointDiv);
    points.push([Math.round(x),Math.round(y)]);
    step++;
    if(step==labels.length) calcBtn.disabled=false;
});

// Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù†Ù‚Ø§Ø·
clearBtn.addEventListener('click', ()=>{
    document.querySelectorAll('.point').forEach(p=>p.remove());
    points=[]; step=0; calcBtn.disabled=true;
});

// Ø§Ø±Ø³Ø§Ù„ Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ø§ÙˆÛŒÙ‡
calcBtn.addEventListener('click', ()=>{
    fetch('/calculate',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({image:imageBase64, joints:{hip:points[0], left_ankle:points[1], right_ankle:points[2]}})
    })
    .then(r=>r.json())
    .then(data=>{
        if(data.error) resultDiv.innerHTML='âŒ '+data.error;
        else resultDiv.innerHTML='âœ… Ø²Ø§ÙˆÛŒÙ‡ Ø§Ù†Ø¹Ø·Ø§Ùâ€ŒÙ¾Ø°ÛŒØ±ÛŒ: '+data.flexibility+'Â°';
    });
});
</script>

</body>
</html>
